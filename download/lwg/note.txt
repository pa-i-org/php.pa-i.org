
[100203:pai]
- index.phpで、commentinfo::attach()が使われていないので削除。
- comment.phpで、$dbにattachするのではなく、別にオープンするように変更。

[091207:pai]
- アルファ版としてリリース。
- コメント機能の概要は以下の通り。
-- ファイル
--- comment.php ---- env.phpからincludeされるスクリプト
--- cedit.php ---- コメント承認のための管理画面
--- calert.php ---- cronから起動し、未承認のコメントがある場合にメールを送るコマンドラインスクリプト
--- comment.sq2 ---- コメント用データベースファイル(コメントを上書きせずにmaster.sq2を差し替えることができる)
-- 設定方法
--- env.phpでcomment.phpをincludeする。
--- env.phpでcommentdbpathを設定する。
--- あらかじめcedit.phpをブラウザから開いて、create tableをおこなっておく(comment.sq2が生成される)。
-- 使用方法
--- コメントを書き込んだ直後(未承認)の状態では、書き込んだIPグループからしかコメントは表示されない。
--- 同じIPグループ内で、未承認のコメントは最大100である(それ以上になると投稿できなくなる)。
--- 1つのコメントの最大サイズは、エンコード後で2048バイトである(それ以上のものは投稿できなくなる)。
--- cedit.phpを開いてedit comment tableを選択すると、未承認のコメントがすべて表示される。
--- allowを選択すると、そのコメントは承認され、全員から見えるようになる。
--- denyを選択すると、そのコメントは拒否され、誰にも見えないようになる(管理画面からは見える)。
--- removeを選択すると、そのコメントはデータベースから削除される(管理画面からも見えなくなる)。
--- IP filterを選択すると、同じIPグループのコメントがすべて表示される。ただし、承認か拒否したものには適用できない。
--- allow allを選択すると、表示されているすべてのコメントが承認され、全員から見えるようになる。表示条件を満たさないコメントはそのままである。deny all、remove allも同様である。
--- 承認するものを順にallowしたあと、残りをまとめてdeny allすると効率的である。
--- show all commentsを選択すると、承認・拒否したものも含めて、コメントがすべて表示される。
--- no referer onlyを選択すると、投稿時にReferer:がなかったものがすべて表示される。

[091028:pai]
- コメント処理で、$variable->getline()がnullであることを考慮していなかったので、修正。
- #showcommentdigestで、DB_genre等がクリアされていなかったのを修正。

[091001:pai]
- コメントレコードのtextの合計が2048バイトを超えるコメントをエラーに。

[090930:pai]
- コメント機能を実装。
-- ロボットによる投稿は、Refererが付かないことを想定して、refererにindexを用意。

[090915:pai]
- CGI呼び出しではPHP_SELFがうまく機能しないので、ORIG_PATH_INFOも使用するように修正。
- コメント機能。
-- #showcommentから#endの間が、&DB_idのコメントでループする機能を追加。
-- #commentdigest以降は、コメントダイジェストの定義になる。&CM_name;などが使用可能。
-- #showcommentdigestは、コメントダイジェストに置換される。
-- 本文中に「[[コメントを書く>?comment=&DB_id;]]」と書くと、コメントページにジャンプ。
-- genre「?comment」で、コメントページを定義できる。

[090914:pai]
- genre「?search」で、検索結果フォーマットをカスタマイズできるように修正。
-- #searchresultの行は、各検索結果のgenreの#searchdigestで置き換わる
-- ディフォールトは以下の通り。

---- ここから ----
#searchresult
&nodata;
---- ここまで ----

[090725:pai]
- foreachcommand::output()で、項目が1つもヒットしないと、warningが出る。要修正。

[090505:pai]
- php5でwarningが出ていたのを修正。

[090505:pai]
- テキストファイルからのアップロードをサポート。テキストファイルの形式は以下の通り。
-- 改ページで区切る。
-- #lead・#body以外で、* で始まる行は、タイトルとなる。
-- #bodyの先頭に、「// tagid=0000ffff;」を入れる。無いとエラー。
--- 0000ffffのところはユニークIDにする。再アップロードした場合に、ここを見て上書きされる。
-- 行そのものを記述しなかった場合、新規作成時は空欄に、更新時は元のままになる。

---- ここから ----
* (タイトル)
#genre news
#type
#version
#date 2009/05/05
#show 0
#par0 (パラメータ0)
#par1
#par2
#par3
#lead
ここがleadの文章です。
#body
// tagid=0000ffff;
ここがbodyの文章です。
#end
(改ページ)
---- ここまで ----

[090106:pai]
- いくつかwarningが出ていたのを修正。

[080502:pai]
- エンコードチェック用の文字列を改善。
- 「[[test]] > [[test2]]」のような形式が正しく解釈されなかったのを修正。
- 「+」によるリストが、「>」や「 」で中断されないように改善。
- 「|>[[link]]|text|」のような表で、先頭の「>」がcolspanと解釈されていたのを修正。
- 「|~[[link]]|text|」のような表で、先頭の「~」がrowspanと解釈されていたのを修正。
- 「'''strong'''」形式の強調に対応。
- env.phpでconvertglobalurl()を定義することで、[[http://]]形式の外部リンクをリダイレクタ経由にする機能に対応。
-- ただし、#sethtmlなどで直接リンクを書いた場合は変換されない。
- env.phpでdebugsysteminfo()を使用していると、edit.phpが動作しないのを修正。

